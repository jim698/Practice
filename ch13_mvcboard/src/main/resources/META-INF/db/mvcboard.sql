DROP TABLE MVC_BOARD CASCADE CONSTRAINTS;
DROP SEQUENCE MVC_BOARD_SEQ;

CREATE SEQUENCE MVC_BOARD_SEQ
MAXVALUE 999999
NOCACHE
NOCYCLE;

CREATE TABLE MVC_BOARD(
    bID NUMBER(6),
    bNAME VARCHAR2(50) NOT NULL,
    bTITLE VARCHAR2(100) NOT NULL,
    bCONTENT VARCHAR2(1000),
    bDATE DATE DEFAULT SYSDATE NOT NULL,
    bHIT NUMBER(6) DEFAULT 0 NOT NULL,
    bGROUP NUMBER(6) NOT NULL,
    bSTEP NUMBER(3) NOT NULL,
    bINDENT NUMBER(3) NOT NULL,
    bIP VARCHAR2(20) NOT NULL,
    PRIMARY KEY(bID)    
);

-- 1. 글목록 (startRow, endRow)

SELECT * FROM (SELECT ROWNUM RN, A.* FROM (SELECT * FROM MVC_BOARD ORDER BY bGROUP DESC, BSTEP) A) WHERE RN BETWEEN 2 AND 3; 

-- 2. 전체 글 갯수
SELECT COUNT(*) FROM MVC_BOARD;

-- 3. 원글쓰기
INSERT INTO MVC_BOARD (bID, bNAME, bTITLE, bCONTENT, bGROUP, bSTEP, bINDENT, bIP) VALUES 
    (MVC_BOARD_SEQ.NEXTVAL, '홍길동', '페이지나와라', '본문', MVC_BOARD_SEQ.CURRVAL, 0, 0, '127.0.0.1');
    
INSERT INTO MVC_BOARD (bID, bNAME, bTITLE, bCONTENT, bGROUP, bSTEP, bINDENT, bIP) VALUES 
    (MVC_BOARD_SEQ.NEXTVAL, '마길동', '으헤헤', '본문이다', MVC_BOARD_SEQ.CURRVAL, 0, 0, '127.0.0.1');    
 

-- 4. BID글 조회수 1회 올리기
UPDATE MVC_BOARD SET bHIT = bHIT + 1 WHERE bID = 1;

-- 5. 상세글 보기(bID로 DTO 가져오기)
SELECT * FROM MVC_BOARD WHERE bID = 1;

-- 6-1. 답변글 쓰기 전 STEP A
UPDATE MVC_BOARD SET bSTEP = bSTEP + 1 WHERE bGROUP = 1 AND bSTEP>0;

-- 6-2. 답변글 쓰기
INSERT INTO MVC_BOARD (bID, bNAME, bTITLE, bCONTENT, bGROUP, bSTEP, bINDENT, bIP) VALUES 
    (MVC_BOARD_SEQ.NEXTVAL, '답변자지롱', '글5첫답', '본문2답변', 2, 1, 1, '127.15.15.30'); 

-- 7. 글 수정하기
UPDATE MVC_BOARD SET bNAME = '김김김', bTITLE='바뀐제목', bCONTENT='바뀐내용', bIP = '192.168.20.44' WHERE bID = 1;

-- 8. 글 삭제하기
DELETE FROM MVC_BOARD WHERE bID = 2;

SELECT * FROM MVC_BOARD WHERE BID=129;

SELECT * FROM MVC_BOARD ORDER BY bGROUP DESC, bSTEP;
COMMIT;



